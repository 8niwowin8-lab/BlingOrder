<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>BlingOrder | å¾Œå°ç®¡ç† (å»šæˆ¿å¼·åŒ–ç‰ˆ)</title>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-database-compat.js"></script>
    <style>
        body { font-family: "PingFang TC", sans-serif; display: flex; margin: 0; background: #fff5f7; height: 100vh; overflow: hidden; }
        
        /* å·¦å´ç®¡ç†å€ */
        .sidebar { width: 320px; padding: 25px; background: white; border-right: 2px solid #ffafcc; overflow-y: auto; }
        .input-group { background: #fff0f3; padding: 15px; border-radius: 12px; margin-bottom: 20px; }
        input { width: 100%; padding: 12px; margin-bottom: 10px; border: 1px solid #ffc2d1; border-radius: 8px; box-sizing: border-box; }
        .btn-add { width: 100%; padding: 12px; background: #ff85a2; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }

        /* å³å´è¨‚å–®å€ - å»šæˆ¿äººå“¡å°ˆç”¨å¤§å­—é«” */
        .main-content { flex: 1; padding: 25px; overflow-y: auto; display: grid; grid-template-columns: 1fr 300px; gap: 25px; }
        
        .order-section h3 { font-size: 28px; color: #ff4d4d; margin-top: 0; display: flex; align-items: center; gap: 10px; }
        
        .order-card { 
            background: white; padding: 25px; margin-bottom: 20px; border-radius: 15px; 
            box-shadow: 0 6px 20px rgba(0,0,0,0.1); border-left: 15px solid #ff85a2; 
        }
        
        .order-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .order-table { font-size: 36px; font-weight: 900; color: #333; }
        .order-time { font-size: 18px; color: #999; }
        
        .order-items { font-size: 32px; font-weight: bold; color: #444; margin: 15px 0; line-height: 1.4; }
        .order-total { font-size: 24px; color: #ff85a2; font-weight: bold; }
        
        .btn-finish { 
            background: #4CAF50; color: white; border: none; padding: 15px 40px; 
            border-radius: 12px; font-size: 24px; font-weight: bold; cursor: pointer; float: right; 
        }

        /* æ•¸æ“šçµ±è¨ˆå€ */
        .data-section { background: white; padding: 20px; border-radius: 15px; height: fit-content; border: 1px solid #ffe0e9; }
        .stats-num { font-size: 36px; color: #ff85a2; font-weight: bold; margin: 10px 0; }
    </style>
</head>
<body>

<audio id="noticeSound" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3" preload="auto"></audio>

<div class="sidebar">
    <h3>âœ¨ èœå–®ç®¡ç†</h3>
    <div class="input-group">
        <input type="text" id="name" placeholder="é¤é»åç¨±">
        <input type="number" id="price" placeholder="åƒ¹æ ¼">
        <input type="text" id="imgUrl" placeholder="åœ–ç‰‡è·¯å¾‘ (ä¾‹: images/pudding.jpg)">
        <button class="btn-add" onclick="addItem()">ç¢ºèªä¸Šæ¶</button>
    </div>
    <div id="admin-menu-list"></div>
</div>

<div class="main-content">
    <div class="order-section">
        <h3>ğŸ”” å¾…è™•ç†è¨‚å–® <span id="new-tag" style="display:none; background:red; color:white; font-size:14px; padding:2px 8px; border-radius:10px;">NEW!</span></h3>
        <div id="order-list"></div>
    </div>
    <div class="data-section">
        <h3>ğŸ“Š ä»Šæ—¥ç‡Ÿæ”¶</h3>
        <div id="stats-area" class="stats-num">$0</div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBTeLTAX-F5i3WHKYY0ITZsla0Qgs5e2zQ",
        authDomain: "blingorder.firebaseapp.com",
        projectId: "blingorder",
        databaseURL: "https://blingorder-default-rtdb.firebaseio.com",
        appId: "1:798993901664:web:9c2023b419ae099fe9fb05"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // æ’­æ”¾éŸ³æ•ˆèˆ‡èªéŸ³åŠŸèƒ½
    function playNotice() {
        const sound = document.getElementById('noticeSound');
        sound.play().catch(e => console.log("ç­‰å¾…ä½¿ç”¨è€…é»æ“Šå¾Œå•Ÿç”¨éŸ³æ•ˆ"));
        
        // èªéŸ³æé†’
        if ('speechSynthesis' in window) {
            const msg = new SpeechSynthesisUtterance("æ‚¨æœ‰æ–°è¨‚å–®");
            msg.lang = 'zh-TW';
            window.speechSynthesis.speak(msg);
        }
    }

    // ç›£è½æ–°è¨‚å–® (ç•¶æœ‰æ–°è³‡æ–™åŠ å…¥æ™‚è§¸ç™¼éŸ³æ•ˆ)
    let firstLoad = true;
    db.ref('orders').on('child_added', snap => {
        if (!firstLoad) {
            playNotice();
            document.getElementById('new-tag').style.display = 'inline';
            setTimeout(() => document.getElementById('new-tag').style.display = 'none', 5000);
        }
    });

    // æ¸²æŸ“è¨‚å–®åˆ—è¡¨
    db.ref('orders').on('value', snap => {
        const list = document.getElementById('order-list');
        list.innerHTML = "";
        let dailyTotal = 0;
        
        snap.forEach(child => {
            const o = child.val();
            if(o.status === "å¾…è™•ç†") {
                list.innerHTML += `
                    <div class="order-card">
                        <div class="order-header">
                            <span class="order-table">${o.table} æ¡Œ</span>
                            <span class="order-time">${o.time}</span>
                        </div>
                        <div class="order-items">${o.items.join('<br>')}</div>
                        <div class="order-total">
                            ç¸½è¨ˆï¼š$${o.total}
                            <button class="btn-finish" onclick="finishOrder('${child.key}')">å‡ºé¤å®Œæˆ</button>
                        </div>
                    </div>
                `;
            }
            if(o.status === "å·²å®Œæˆ") dailyTotal += parseInt(o.total);
        });
        document.getElementById('stats-area').innerText = `$${dailyTotal}`;
        firstLoad = false; // åˆå§‹åŠ è¼‰å®Œæˆ
    });

    function finishOrder(id) { db.ref('orders/'+id).update({ status: 'å·²å®Œæˆ' }); }

    // èœå–®ç®¡ç†åŠŸèƒ½ (ç•¥)
    function addItem() {
        const n = document.getElementById('name').value;
        const p = document.getElementById('price').value;
        const img = document.getElementById('imgUrl').value;
        if(n && p) {
            db.ref('menu/' + Date.now()).set({ name: n, price: p, image: img, isSoldOut: false });
            document.getElementById('name').value=""; document.getElementById('price').value=""; document.getElementById('imgUrl').value="";
        }
    }
    
    db.ref('menu').on('value', snap => {
        const list = document.getElementById('admin-menu-list');
        list.innerHTML = "";
        snap.forEach(child => {
            const item = child.val();
            list.innerHTML += `<div style="padding:10px; border-bottom:1px solid #eee;">${item.name} ($${item.price})</div>`;
        });
    });
</script>
</body>
</html>