<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>BlingOrder | å¾Œå°ç®¡ç† (ç‰ˆæœ¬ 2.1)</title>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-database-compat.js"></script>
    <style>
        body { font-family: "PingFang TC", sans-serif; display: flex; margin: 0; background: #fff5f7; height: 100vh; overflow: hidden; }
        
        /* å·¦å´ç®¡ç†å€ */
        .sidebar { width: 320px; padding: 25px; background: white; border-right: 2px solid #ffafcc; overflow-y: auto; box-shadow: 4px 0 15px rgba(0,0,0,0.05); }
        h3 { color: #ff85a2; margin-top: 0; display: flex; align-items: center; gap: 8px; }
        
        .input-group { background: #fff0f3; padding: 15px; border-radius: 12px; margin-bottom: 20px; }
        input { width: 100%; padding: 12px; margin-bottom: 10px; border: 1px solid #ffc2d1; border-radius: 8px; box-sizing: border-box; font-size: 14px; }
        input:focus { outline: none; border-color: #ff85a2; box-shadow: 0 0 5px rgba(255,133,162,0.3); }
        
        .btn-add { width: 100%; padding: 12px; background: #ff85a2; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 16px; transition: 0.3s; }
        .btn-add:hover { background: #ff6384; transform: translateY(-2px); }

        /* é¤é»åˆ—è¡¨é … */
        .item-card { background: white; padding: 12px; margin-top: 12px; border-radius: 10px; border: 1px solid #ffe0e9; box-shadow: 0 2px 5px rgba(0,0,0,0.02); display: flex; flex-direction: column; gap: 8px; }
        .item-info { display: flex; justify-content: space-between; font-weight: bold; color: #444; }
        .item-path { font-size: 11px; color: #999; word-break: break-all; }
        .item-btns { display: flex; gap: 5px; }
        .item-btns button { flex: 1; padding: 6px; border: none; border-radius: 5px; cursor: pointer; font-size: 12px; font-weight: bold; }
        .btn-sold { background: #ffca3a; color: white; }
        .btn-del { background: #eee; color: #888; }

        /* å³å´è¨‚å–®èˆ‡æ•¸æ“š */
        .main-content { flex: 1; padding: 25px; overflow-y: auto; display: grid; grid-template-columns: 1fr 300px; gap: 20px; }
        .order-section { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .data-section { background: #fff; padding: 20px; border-radius: 15px; border: 1px solid #ffe0e9; height: fit-content; }
    </style>
</head>
<body>

<div class="sidebar">
    <h3>âœ¨ èœå–®ç®¡ç† (v2.1)</h3>
    <div class="input-group">
        <input type="text" id="name" placeholder="é¤é»åç¨± (ä¾‹: æ˜­å’Œç¡¬å¸ƒä¸)">
        <input type="number" id="price" placeholder="é¤é»åƒ¹æ ¼ (ä¾‹: 160)">
        <input type="text" id="imgUrl" placeholder="åœ–ç‰‡è·¯å¾‘ (ä¾‹: images/pudding.jpg)">
        <button class="btn-add" onclick="addItem()">ç¢ºèªä¸Šæ¶é¤é»</button>
    </div>
    <hr style="border: 0; border-top: 1px solid #ffe0e9; margin: 20px 0;">
    <div id="admin-menu-list"></div>
</div>

<div class="main-content">
    <div class="order-section">
        <h3>ğŸ”” å¾…è™•ç†è¨‚å–®</h3>
        <div id="order-list"></div>
    </div>
    <div class="data-section">
        <h3>ğŸ“Š ä»Šæ—¥ç‡Ÿé‹æ•¸æ“š</h3>
        <div id="stats-area">è¼‰å…¥ä¸­...</div>
    </div>
</div>

<script>
    // Firebase é…ç½® (è«‹ç¢ºä¿èˆ‡æ‚¨ç›®å‰çš„é…ç½®ä¸€è‡´)
    const firebaseConfig = {
        apiKey: "AIzaSyBTeLTAX-F5i3WHKYY0ITZsla0Qgs5e2zQ",
        authDomain: "blingorder.firebaseapp.com",
        projectId: "blingorder",
        databaseURL: "https://blingorder-default-rtdb.firebaseio.com",
        appId: "1:798993901664:web:9c2023b419ae099fe9fb05"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // 1. æ–°å¢é¤é»åŠŸèƒ½
    function addItem() {
        const n = document.getElementById('name').value;
        const p = document.getElementById('price').value;
        const img = document.getElementById('imgUrl').value;
        if(n && p) {
            db.ref('menu/' + Date.now()).set({
                name: n,
                price: p,
                image: img || "", // å­˜å„²åœ–ç‰‡è·¯å¾‘
                isSoldOut: false
            });
            document.getElementById('name').value="";
            document.getElementById('price').value="";
            document.getElementById('imgUrl').value="";
        } else {
            alert("è«‹å¡«å¯«åç¨±èˆ‡åƒ¹æ ¼ï¼");
        }
    }

    // 2. é¡¯ç¤ºç®¡ç†æ¸…å–®
    db.ref('menu').on('value', snap => {
        const list = document.getElementById('admin-menu-list');
        list.innerHTML = "";
        snap.forEach(child => {
            const item = child.val();
            list.innerHTML += `
                <div class="item-card">
                    <div class="item-info">
                        <span>${item.name}</span>
                        <span>$${item.price}</span>
                    </div>
                    <div class="item-path">ğŸ–¼ï¸ ${item.image || 'æœªè¨­å®šåœ–ç‰‡'}</div>
                    <div class="item-btns">
                        <button class="btn-sold" onclick="toggleSoldOut('${child.key}', ${item.isSoldOut})">${item.isSoldOut?'è£œè²¨':'å”®ç½„'}</button>
                        <button class="btn-del" onclick="deleteItem('${child.key}')">åˆªé™¤</button>
                    </div>
                </div>
            `;
        });
    });

    function toggleSoldOut(id, status) { db.ref('menu/'+id).update({ isSoldOut: !status }); }
    function deleteItem(id) { if(confirm('ç¢ºå®šåˆªé™¤æ­¤é¤é»ï¼Ÿ')) db.ref('menu/'+id).remove(); }

    // 3. è¨‚å–®ç›£è½ (ç¶­æŒæ‚¨åŸæœ¬çš„åŠŸèƒ½)
    db.ref('orders').on('value', snap => {
        const list = document.getElementById('order-list');
        list.innerHTML = "";
        let dailyTotal = 0;
        snap.forEach(child => {
            const o = child.val();
            if(o.status === "å¾…è™•ç†") {
                list.innerHTML += `
                    <div style="background:#fff5f7; padding:15px; margin-bottom:10px; border-radius:10px; border:1px solid #ffe0e9;">
                        <b>æ¡Œè™Ÿï¼š${o.table}</b> <span style="font-size:12px; color:#999;">(${o.time})</span><br>
                        <div style="margin:8px 0;">${o.items.join(', ')}</div>
                        <b>ç¸½è¨ˆï¼š$${o.total}</b>
                        <button onclick="finishOrder('${child.key}')" style="float:right; background:#ff85a2; color:white; border:none; padding:5px 15px; border-radius:5px; cursor:pointer;">å®Œæˆ</button>
                    </div>
                `;
            }
            if(o.status === "å·²å®Œæˆ") dailyTotal += parseInt(o.total);
        });
        document.getElementById('stats-area').innerHTML = `ä»Šæ—¥ç´¯è¨ˆç‡Ÿæ”¶ï¼š<h2 style="color:#ff85a2; margin:5px 0;">$${dailyTotal}</h2>`;
    });
    function finishOrder(id) { db.ref('orders/'+id).update({ status: 'å·²å®Œæˆ' }); }
</script>
</body>
</html>