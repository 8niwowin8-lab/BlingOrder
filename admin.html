<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlingOrder | æ¥å–®ç®¡ç†å¾Œå°</title>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-database-compat.js"></script>
    <style>
        :root { --primary-pink: #ff85a2; --bg: #fdfdfd; }
        body { font-family: "PingFang TC", sans-serif; background: var(--bg); margin: 0; padding: 0; }
        
        /* èªéŸ³å¼·åˆ¶å•Ÿå‹•é–€ç°¾ */
        #voice-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--primary-pink); z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; }
        .start-btn { padding: 30px 60px; font-size: 40px; font-weight: 900; background: white; color: var(--primary-pink); border: none; border-radius: 50px; cursor: pointer; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .start-btn:active { transform: scale(0.95); }

        /* é ‚éƒ¨æ¨™é¡Œåˆ— */
        .admin-header { background: white; padding: 20px; border-bottom: 3px solid var(--primary-pink); display: flex; justify-content: space-between; align-items: center; }
        .rev-info { text-align: right; background: #333; color: white; padding: 10px 20px; border-radius: 12px; }

        /* å›æ­¸åŸæœ¬çš„æ¸…å–®å¼ç·¨æ’ */
        .order-list-container { padding: 15px; }
        .order-row { background: white; border-radius: 15px; padding: 25px; margin-bottom: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); border: 2px solid #eee; display: flex; align-items: center; }
        
        /* æ¡Œè™Ÿå­—é«”å›æ­¸å¤§å­—æ„Ÿ */
        .table-box { min-width: 140px; text-align: center; border-right: 3px solid #eee; margin-right: 25px; }
        .table-text { font-size: 36px; font-weight: 900; color: #333; }
        .table-text.booth { color: var(--primary-pink); }
        
        /* å“é …æ¸…å–®åŠ å¤§åŠ ç²— */
        .items-box { flex-grow: 1; }
        .item-detail { font-size: 32px; font-weight: 800; color: #000; line-height: 1.4; }
        
        /* é‡‘é¡èˆ‡çµå¸³æŒ‰éˆ• */
        .action-box { min-width: 200px; text-align: right; margin-left: 20px; }
        .price-text { font-size: 24px; font-weight: bold; color: var(--primary-pink); margin-bottom: 15px; }
        .btn-done { background: #4caf50; color: white; border: none; padding: 20px 30px; border-radius: 15px; font-size: 24px; font-weight: bold; cursor: pointer; width: 100%; box-shadow: 0 4px 0 #388e3c; }
        .btn-done:active { transform: translateY(3px); box-shadow: 0 1px 0 #388e3c; }

        .report-link { display: block; text-align: center; padding: 15px; color: #888; text-decoration: none; font-weight: bold; }
    </style>
</head>
<body>

<div id="voice-overlay">
    <h1 style="font-size: 32px; margin-bottom: 30px;">ğŸ“¢ æº–å‚™é–‹å§‹ç‡Ÿæ¥­å—ï¼Ÿ</h1>
    <button class="start-btn" onclick="initVoice()">é»æ­¤å•Ÿå‹•ç³»çµ±</button>
    <p style="margin-top: 20px; font-weight: bold;">(å•Ÿå‹•å¾Œå°‡é–‹å•Ÿè‡ªå‹•èªéŸ³æé†’)</p>
</div>

<div class="admin-header">
    <h1 style="margin:0; font-size:24px; color:var(--primary-pink);">ğŸ’ BlingOrder æ¥å–®çœ‹æ¿</h1>
    <div class="rev-info">
        <div style="font-size:12px; opacity:0.8;">ä»Šæ—¥ç‡Ÿæ”¶</div>
        <div id="rev-val" style="font-size:24px; font-weight:bold;">$0</div>
    </div>
</div>

<div class="order-list-container" id="list-box">
    </div>

<a href="report.html" class="report-link">å‰å¾€ç‡Ÿæ”¶å ±è¡¨æ˜ç´° â®•</a>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBTeLTAX-F5i3WHKYY0ITZsla0Qgs5e2zQ",
        authDomain: "blingorder.firebaseapp.com",
        projectId: "blingorder",
        databaseURL: "https://blingorder-default-rtdb.firebaseio.com",
        appId: "1:798993901664:web:9c2023b419ae099fe9fb05"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let canSpeak = false;
    let knownOrderIds = new Set();
    const todayStr = new Date().toLocaleDateString('zh-TW');

    // å•Ÿå‹•èªéŸ³ä¸¦è§£é™¤é®ç½©
    function initVoice() {
        canSpeak = true;
        document.getElementById('voice-overlay').style.display = 'none';
        const msg = new SpeechSynthesisUtterance("ç³»çµ±å·²å•Ÿå‹•ï¼Œç¥æ‚¨ç”Ÿæ„èˆˆéš†");
        msg.lang = 'zh-TW';
        window.speechSynthesis.speak(msg);
    }

    db.ref('orders').on('value', snap => {
        const listBox = document.getElementById('list-box');
        listBox.innerHTML = "";
        let todaySum = 0;
        let foundNew = false;

        snap.forEach(child => {
            const o = child.val();
            const id = child.key;
            const orderDate = new Date(parseInt(o.timestamp || id)).toLocaleDateString('zh-TW');

            if (orderDate === todayStr) {
                todaySum += parseInt(o.total || 0);

                if (o.status !== "å·²çµå¸³") {
                    if (!knownOrderIds.has(id) && knownOrderIds.size > 0) {
                        foundNew = true;
                    }
                    knownOrderIds.add(id);

                    const isB = (o.table == "7" || o.table == "åŒ…å»‚");
                    const tableDisplay = isB ? "ğŸ’åŒ…å»‚" : o.table + "æ¡Œ";
                    
                    listBox.innerHTML = `
                        <div class="order-row">
                            <div class="table-box">
                                <div class="table-text ${isB ? 'booth' : ''}">${tableDisplay}</div>
                            </div>
                            <div class="items-box">
                                <div class="item-detail">${(o.items || []).join('ã€')}</div>
                            </div>
                            <div class="action-box">
                                <div class="price-text">æ‡‰æ”¶ $${o.total}</div>
                                <button class="btn-done" onclick="finishOrder('${id}')">çµå¸³å®Œæˆ</button>
                            </div>
                        </div>` + listBox.innerHTML;
                }
            }
        });

        if (foundNew && canSpeak) {
            const msg = new SpeechSynthesisUtterance("æ‚¨æœ‰æ–°è¨‚å–®");
            msg.lang = 'zh-TW';
            window.speechSynthesis.speak(msg);
        }

        document.getElementById('rev-val').innerText = "$" + todaySum.toLocaleString();
    });

    function finishOrder(id) {
        db.ref('orders/' + id).update({ status: "å·²çµå¸³" });
    }
</script>
</body>
</html>