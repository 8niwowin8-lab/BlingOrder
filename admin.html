<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlingOrder | å»šæˆ¿æ¥å–®ç³»çµ±</title>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-database-compat.js"></script>
    <style>
        :root { --primary-pink: #ff85a2; --bg-gray: #f8f9fa; }
        body { font-family: "PingFang TC", sans-serif; background: var(--bg-gray); margin: 0; padding: 20px; }
        
        /* å•Ÿå‹•éŸ³æ•ˆæé†’ */
        #audio-unlock-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,133,162,0.9); z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: white; font-size: 24px; font-weight: bold; text-align: center;
        }
        .unlock-btn {
            background: white; color: var(--primary-pink); border: none;
            padding: 20px 40px; border-radius: 50px; font-size: 28px;
            margin-top: 20px; cursor: pointer; box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .top-bar { display: flex; justify-content: space-between; align-items: center; background: white; padding: 20px 30px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 30px; }
        .system-title { font-size: 28px; font-weight: 800; color: var(--primary-pink); }
        .order-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 25px; }
        .order-card { 
            background: white; border-radius: 25px; padding: 30px; 
            box-shadow: 0 8px 30px rgba(0,0,0,0.1); border-left: 20px solid var(--primary-pink);
            display: flex; flex-direction: column; animation: fadeIn 0.3s ease-out;
        }
        .table-num { font-size: 50px; font-weight: 900; color: #222; }
        .item-list { font-size: 38px; font-weight: bold; color: #444; line-height: 1.5; margin-bottom: 25px; flex-grow: 1; }
        .btn-done { background: #4CAF50; color: white; border: none; padding: 20px 45px; border-radius: 15px; font-size: 28px; font-weight: bold; cursor: pointer; }
        .nav-link { position: fixed; bottom: 20px; right: 20px; color: #ccc; text-decoration: none; font-size: 14px; }
    </style>
</head>
<body>

<div id="audio-unlock-overlay">
    <div>ğŸ“¢ æ­¡è¿å›ä¾†ï¼ç‚ºäº†å•Ÿå‹•æ–°è¨‚å–®é€šçŸ¥éŸ³æ•ˆ</div>
    <button class="unlock-btn" onclick="unlockAudio()">é»æ“Šé€™è£¡å•Ÿå‹•ç³»çµ±</button>
</div>

<audio id="noticeSound" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3" preload="auto"></audio>

<div class="top-bar">
    <div class="system-title">BlingOrder å»šæˆ¿æ¥å–® âœ¨</div>
    <div style="text-align: right;">
        <div style="font-size: 16px; color: #888;">ä»Šæ—¥ç‡Ÿæ”¶</div>
        <div style="font-size: 32px; font-weight: bold;" id="stats-area">$0</div>
    </div>
</div>

<div class="order-container" id="order-list"></div>

<a href="menu-edit.html" class="nav-link">âš™ï¸ é€²å…¥èœå–®ç®¡ç†</a>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBTeLTAX-F5i3WHKYY0ITZsla0Qgs5e2zQ",
        authDomain: "blingorder.firebaseapp.com",
        projectId: "blingorder",
        databaseURL: "https://blingorder-default-rtdb.firebaseio.com",
        appId: "1:798993901664:web:9c2023b419ae099fe9fb05"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // é—œéµä¿®å¾©ï¼šè§£é–éŸ³æ•ˆèˆ‡èªéŸ³
    function unlockAudio() {
        // æ’­æ”¾ä¸€æ¬¡çŸ­ä¿ƒçš„éœéŸ³æˆ–æ¸¬è©¦éŸ³
        const sound = document.getElementById('noticeSound');
        sound.play().then(() => {
            sound.pause();
            sound.currentTime = 0;
            // èªéŸ³æ¸¬è©¦
            if ('speechSynthesis' in window) {
                const msg = new SpeechSynthesisUtterance("ç³»çµ±å·²å•Ÿå‹•");
                msg.lang = 'zh-TW';
                window.speechSynthesis.speak(msg);
            }
            // éš±è—è¦†è“‹å±¤
            document.getElementById('audio-unlock-overlay').style.display = 'none';
        }).catch(e => alert("è«‹å†è©¦ä¸€æ¬¡ï¼"));
    }

    function playNotice() {
        const sound = document.getElementById('noticeSound');
        sound.currentTime = 0;
        sound.play().catch(e => console.log("éŸ³æ•ˆæ’­æ”¾å—é˜»"));
        
        if ('speechSynthesis' in window) {
            const msg = new SpeechSynthesisUtterance("æ‚¨æœ‰æ–°è¨‚å–®");
            msg.lang = 'zh-TW';
            window.speechSynthesis.speak(msg);
        }
    }

    let firstLoad = true;
    // ç›£è½æ–°è¨‚å–®ï¼ˆå­ç¯€é»åŠ å…¥ï¼‰
    db.ref('orders').on('child_added', snap => {
        if (!firstLoad) {
            playNotice();
        }
    });

    // ç›£è½æ‰€æœ‰è¨‚å–®ï¼ˆæ¸²æŸ“ç•«é¢ï¼‰
    db.ref('orders').on('value', snap => {
        const list = document.getElementById('order-list');
        list.innerHTML = "";
        let dailyTotal = 0;
        
        snap.forEach(child => {
            const o = child.val();
            if(o.status === "å¾…è™•ç†") {
                const itemsHtml = o.items.map(item => `<div>â€¢ ${item}</div>`).join('');
                list.innerHTML += `
                    <div class="order-card">
                        <div style="display:flex; justify-content:space-between; margin-bottom:15px; border-bottom:2px solid #f0f0f0; padding-bottom:15px;">
                            <span class="table-num">${o.table} æ¡Œ</span>
                            <span style="font-size:20px; color:#aaa; margin-top:15px;">${o.time}</span>
                        </div>
                        <div class="item-list">${itemsHtml}</div>
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <span style="font-size:26px; color:var(--primary-pink); font-weight:bold;">$${o.total}</span>
                            <button class="btn-done" onclick="finishOrder('${child.key}')">å®Œæˆå‡ºé¤</button>
                        </div>
                    </div>
                `;
            }
            if(o.status === "å·²å®Œæˆ") dailyTotal += parseInt(o.total);
        });
        document.getElementById('stats-area').innerText = `$${dailyTotal}`;
        firstLoad = false;
    });

    function finishOrder(id) { db.ref('orders/'+id).update({ status: 'å·²å®Œæˆ' }); }
</script>
</body>
</html>