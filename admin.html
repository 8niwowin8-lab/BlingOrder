<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlingOrder | å¤§å­—é«”å³æ™‚çœ‹æ¿</title>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-database-compat.js"></script>
    <style>
        :root { --primary-pink: #ff85a2; --bg: #f8f9fa; }
        body { font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; background: var(--bg); margin: 0; padding: 10px; }
        .admin-header { background: white; padding: 15px 25px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 5px solid var(--primary-pink); }
        .revenue-box { background: #333; color: #fff; padding: 10px 20px; border-radius: 10px; text-align: right; }
        .voice-btn { width: 100%; padding: 20px; background: #2196f3; color: white; border: none; border-radius: 15px; font-weight: bold; margin-bottom: 20px; font-size: 22px; cursor: pointer; box-shadow: 0 4px 0 #1976d2; }
        .order-card { background: white; border-radius: 25px; padding: 30px; margin-bottom: 25px; box-shadow: 0 8px 30px rgba(0,0,0,0.15); border: 3px solid #eee; }
        .table-tag { font-size: 48px; font-weight: 900; color: #fff; background: #333; padding: 10px 30px; border-radius: 15px; display: inline-block; margin-bottom: 20px; }
        .table-tag.booth { background: var(--primary-pink); }
        .item-row { padding: 15px 0; border-bottom: 2px solid #f9f9f9; color: #000; font-size: 36px; font-weight: 900; line-height: 1.4; }
        .total-info { margin-top: 25px; font-size: 28px; font-weight: bold; color: #d32f2f; text-align: right; }
        .btn-done { background: #4caf50; color: white; border: none; padding: 25px; border-radius: 20px; font-weight: bold; margin-top: 25px; width: 100%; font-size: 32px; cursor: pointer; box-shadow: 0 6px 0 #388e3c; }
    </style>
</head>
<body>
<div class="admin-header">
    <h1 style="font-size:28px; color:var(--primary-pink); margin:0;">ğŸ’ ä»Šæ—¥è¨‚å–®ç›£æ§</h1>
    <div class="revenue-box">
        <div style="font-size:14px; opacity:0.8;">ä»Šæ—¥ç‡Ÿæ”¶</div>
        <div id="rev-val" style="font-size:32px; font-weight:900;">$0</div>
    </div>
</div>
<button class="voice-btn" onclick="startVoice()" id="v-btn">ğŸ”Š é»æˆ‘ï¼šé–‹å•ŸèªéŸ³æ’­å ±</button>
<div id="list-box"></div>
<script>
    const firebaseConfig = { apiKey: "AIzaSyBTeLTAX-F5i3WHKYY0ITZsla0Qgs5e2zQ", authDomain: "blingorder.firebaseapp.com", projectId: "blingorder", databaseURL: "https://blingorder-default-rtdb.firebaseio.com", appId: "1:798993901664:web:9c2023b419ae099fe9fb05" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let canSpeak = false; let knownIds = new Set();
    const today = new Date().toLocaleDateString('zh-TW');

    function startVoice() { canSpeak = true; document.getElementById('v-btn').innerText = "âœ… èªéŸ³å°±ç·’"; document.getElementById('v-btn').style.background = "#8bc34a"; }

    db.ref('orders').on('value', snap => {
        const listBox = document.getElementById('list-box'); listBox.innerHTML = "";
        let todaySum = 0; let foundNew = false;
        snap.forEach(child => {
            const o = child.val(); const id = child.key;
            const orderDate = new Date(parseInt(o.timestamp || id)).toLocaleDateString('zh-TW');
            if (orderDate === today) {
                todaySum += parseInt(o.total || 0);
                if (o.status !== "å·²çµå¸³") {
                    if (!knownIds.has(id) && knownIds.size > 0) foundNew = true;
                    knownIds.add(id);
                    const isB = (o.table == "åŒ…å»‚" || o.table == "7");
                    let itemsHtml = (o.items || []).map(i => `<div class="item-row">â— ${i}</div>`).join('');
                    listBox.innerHTML = `<div class="order-card"><span class="table-tag ${isB?'booth':''}">${isB?'ğŸ’ åŒ…å»‚':'ç¬¬ '+o.table+' æ¡Œ'}</span><div class="item-list">${itemsHtml}</div><div class="total-info">é‡‘é¡ï¼š$${o.total}</div><button class="btn-done" onclick="finishOrder('${id}')">çµå¸³å®Œæˆ</button></div>` + listBox.innerHTML;
                }
            }
        });
        if (foundNew && canSpeak) { let m = new SpeechSynthesisUtterance("æ–°è¨‚å–®"); m.lang='zh-TW'; window.speechSynthesis.speak(m); }
        document.getElementById('rev-val').innerText = "$" + todaySum.toLocaleString();
        if (listBox.innerHTML === "") listBox.innerHTML = `<p style="text-align:center; padding:100px 0; color:#ccc; font-size:30px;">ç›®å‰ç„¡å¾…è™•ç†è¨‚å–®</p>`;
    });

    function finishOrder(id) { db.ref('orders/' + id).update({ status: "å·²çµå¸³" }); }
</script>
</body>
</html>