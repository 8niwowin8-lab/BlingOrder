<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlingOrder | å®Œæ•´æ•¸æ“šç®¡ç†</title>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-database-compat.js"></script>
    <style>
        :root { --primary-pink: #ff85a2; --free-green: #4caf50; --del-red: #f44336; }
        body { font-family: "PingFang TC", sans-serif; background: #f0f2f5; margin: 0; padding: 10px; }
        
        /* æ•¸æ“šçµ±è¨ˆå€ */
        .stats-container { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 15px; }
        .stat-card { background: #333; color: white; padding: 12px 5px; border-radius: 12px; text-align: center; border-bottom: 4px solid var(--primary-pink); }
        .stat-val { font-size: 18px; font-weight: bold; color: var(--primary-pink); display: block; }
        .stat-label { font-size: 11px; opacity: 0.8; }

        /* è¨‚å–®å¡ç‰‡ */
        .order-item { background: white; border-radius: 15px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-left: 6px solid var(--primary-pink); }
        .order-info { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        
        /* æ—¥æœŸèˆ‡æ™‚é–“å­—é«”å„ªåŒ– */
        .date-box { font-size: 13px; color: #666; line-height: 1.4; }
        .date-text { color: #999; font-size: 11px; }
        .time-text { font-size: 18px; font-weight: bold; color: #333; }
        
        .order-table { font-size: 20px; font-weight: 900; color: #333; margin-left: 10px; }
        .order-price { font-size: 22px; font-weight: 900; color: var(--primary-pink); }
        .order-price.is-free { color: var(--free-green); text-decoration: line-through; }
        
        .food-list { font-size: 15px; color: #444; background: #f9f9f9; padding: 10px; border-radius: 8px; margin-bottom: 12px; border: 1px dashed #ddd; }
        
        .action-row { display: flex; gap: 8px; }
        .btn-act { flex: 1; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 14px; }
        .btn-free { background: #e8f5e9; color: var(--free-green); border: 1px solid var(--free-green); }
        .btn-del { background: #ffebee; color: var(--del-red); border: 1px solid var(--del-red); }
        
        .btn-back { display: block; width: 100%; text-align: center; padding: 15px; background: white; color: #333; text-decoration: none; border-radius: 12px; margin-bottom: 15px; font-weight: bold; border: 2px solid #ddd; box-sizing: border-box; }
    </style>
</head>
<body>

<a href="admin.html" class="btn-back">â¬… è¿”å›æ¥å–®å¾Œå°</a>

<div class="stats-container">
    <div class="stat-card"><span class="stat-label">ä»Šæ—¥ç‡Ÿæ¥­é¡</span><span class="stat-val" id="rev-val">$0</span></div>
    <div class="stat-card"><span class="stat-label">ç¸½å–®æ•¸</span><span class="stat-val" id="qty-val">0</span></div>
    <div class="stat-card"><span class="stat-label">å®¢å–®åƒ¹</span><span class="stat-val" id="avg-val">$0</span></div>
</div>

<div id="main-list"></div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBTeLTAX-F5i3WHKYY0ITZsla0Qgs5e2zQ",
        authDomain: "blingorder.firebaseapp.com",
        projectId: "blingorder",
        databaseURL: "https://blingorder-default-rtdb.firebaseio.com",
        appId: "1:798993901664:web:9c2023b419ae099fe9fb05"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const todayStr = new Date().toLocaleDateString('zh-TW');

    db.ref('orders').on('value', snap => {
        const container = document.getElementById('main-list');
        container.innerHTML = "";
        let rev = 0, qty = 0;
        let list = [];

        snap.forEach(child => {
            const o = child.val();
            o.id = child.key;
            list.push(o);
        });
        list.reverse();

        list.forEach(o => {
            const timeObj = new Date(parseInt(o.timestamp || o.id));
            const orderDate = timeObj.toLocaleDateString('zh-TW');
            const orderTime = timeObj.toLocaleTimeString('zh-TW', {hour:'2-digit', minute:'2-digit'});

            if (orderDate === todayStr) {
                rev += parseInt(o.total || 0);
                qty += 1;
            }

            const isBooth = (o.table == "7" || o.table == "åŒ…å»‚");
            const priceStyle = (parseInt(o.total) === 0) ? "is-free" : "";

            container.innerHTML += `
                <div class="order-item">
                    <div class="order-info">
                        <div class="date-box">
                            <span class="date-text">${orderDate}</span><br>
                            <span class="time-text">${orderTime}</span>
                        </div>
                        <span class="order-table">${isBooth ? 'ğŸ’ åŒ…å»‚' : o.table + ' æ¡Œ'}</span>
                        <div class="order-price ${priceStyle}">$${o.total}</div>
                    </div>
                    <div class="food-list"><b>æ˜ç´°ï¼š</b>${(o.items || []).join('ã€')}</div>
                    <div class="action-row">
                        <button class="btn-act btn-free" onclick="doFree('${o.id}')">ğŸ å…å–®</button>
                        <button class="btn-act btn-del" onclick="doDel('${o.id}')">ğŸ—‘ åˆªé™¤</button>
                    </div>
                </div>`;
        });

        document.getElementById('rev-val').innerText = `$${rev.toLocaleString()}`;
        document.getElementById('qty-val').innerText = `${qty} å–®`;
        document.getElementById('avg-val').innerText = `$${qty > 0 ? Math.round(rev/qty) : 0}`;
        
        if(container.innerHTML === "") container.innerHTML = "<p style='text-align:center; padding:50px; color:#999;'>å°šç„¡è¨‚å–®è³‡æ–™</p>";
    });

    function doFree(id) {
        if(confirm("ç¢ºå®šè¦å°‡é€™ç­†è¨‚å–®æ”¹ç‚º 0 å…ƒå—ï¼Ÿ")) {
            db.ref('orders/' + id).update({ total: 0 });
        }
    }

    function doDel(id) {
        if(confirm("ã€æ°¸ä¹…åˆªé™¤è­¦å‘Šã€‘\nç¢ºå®šè¦åˆªé™¤é€™ç­†è¨‚å–®å—ï¼Ÿåˆªé™¤å¾Œå°‡ä¸è¨ˆå…¥ç‡Ÿæ¥­é¡ï¼")) {
            db.ref('orders/' + id).remove();
        }
    }
</script>
</body>
</html>