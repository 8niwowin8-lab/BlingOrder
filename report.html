<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlingOrder | å ±è¡¨ä¸­å¿ƒ (æ—¥æœŸå¼·åŒ–ç‰ˆ)</title>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-database-compat.js"></script>
    <style>
        :root { --primary-pink: #ff85a2; --soft-pink: #fffafa; }
        body { font-family: "PingFang TC", sans-serif; background: var(--soft-pink); margin: 0; padding: 25px; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .title { color: var(--primary-pink); font-size: 26px; font-weight: bold; }
        
        /* æ•¸æ“šå¡ç‰‡ */
        .stat-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 35px; }
        .stat-card { background: white; padding: 25px; border-radius: 20px; text-align: center; box-shadow: 0 5px 20px rgba(255,133,162,0.1); border: 1px solid #fff0f3; }
        .stat-val { font-size: 32px; font-weight: 800; color: var(--primary-pink); margin-top: 10px; }
        .stat-label { color: #888; font-size: 14px; font-weight: bold; }

        /* è¡¨æ ¼æ¨£å¼ */
        .table-container { background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
        table { width: 100%; border-collapse: collapse; }
        th { background: #fff0f3; color: #555; padding: 18px; text-align: left; font-size: 15px; }
        td { padding: 18px; border-bottom: 1px solid #fdfdfd; font-size: 15px; color: #444; }
        
        /* æ—¥æœŸå¼·èª¿ */
        .date-today { color: var(--primary-pink); font-weight: bold; }
        .date-past { color: #999; }
        
        .btn-comp { background: #e3f2fd; color: #1976d2; border: 1px solid #bbdefb; padding: 8px 15px; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .btn-del { background: #fff0f0; color: #ff4d4d; border: 1px solid #ffccd5; padding: 8px 15px; border-radius: 8px; cursor: pointer; margin-left: 8px; font-weight: bold; }
    </style>
</head>
<body>

<div class="header">
    <div class="title">ğŸ“Š ç‡Ÿé‹æ•¸æ“šåˆ†æä¸­å¿ƒ</div>
    <div id="today-display" style="color:#aaa; font-weight:bold;">åŸºæº–æ—¥ï¼š2026/02/15</div>
</div>

<div class="stat-grid">
    <div class="stat-card">
        <div class="stat-label">ä»Šæ—¥ç¸½è¨‚å–® (2/15)</div>
        <div class="stat-val" id="today-count">0</div>
    </div>
    <div class="stat-card">
        <div class="stat-label">ä»Šæ—¥ç‡Ÿæ¥­é¡ (2/15)</div>
        <div class="stat-val" id="today-revenue">$0</div>
    </div>
    <div class="stat-card">
        <div class="stat-label">ç†±é–€æ¡Œè™Ÿ (æœ¬æ—¥)</div>
        <div class="stat-val" id="top-table">--</div>
    </div>
</div>

<div class="table-container">
    <table>
        <thead>
            <tr>
                <th>æ—¥æœŸæ™‚é–“</th>
                <th>æ¡Œè™Ÿ</th>
                <th>é¤é»æ˜ç´°</th>
                <th style="text-align:right">é‡‘é¡</th>
                <th style="text-align:center">ç®¡ç†æ“ä½œ</th>
            </tr>
        </thead>
        <tbody id="order-tbody"></tbody>
    </table>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBTeLTAX-F5i3WHKYY0ITZsla0Qgs5e2zQ",
        authDomain: "blingorder.firebaseapp.com",
        projectId: "blingorder",
        databaseURL: "https://blingorder-default-rtdb.firebaseio.com",
        appId: "1:798993901664:web:9c2023b419ae099fe9fb05"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const todayStr = "2026/2/15"; // è¨­å®šåŸºæº–æ—¥ç‚ºä»Šæ—¥
    document.getElementById('today-display').innerText = `çµç®—åŸºæº–æ—¥ï¼š${todayStr}`;

    db.ref('orders').on('value', snap => {
        let todaySum = 0;
        let todayQty = 0;
        let tableFreq = {};
        const tbody = document.getElementById('order-tbody');
        tbody.innerHTML = "";

        const orders = [];
        snap.forEach(child => {
            const o = child.val();
            o.id = child.key;
            orders.unshift(o); 
        });

        orders.forEach(o => {
            const orderDateObj = new Date(parseInt(o.id || Date.now()));
            // æ ¼å¼åŒ–ç‚º å¹´/æœˆ/æ—¥ æ™‚:åˆ†
            const fullDate = orderDateObj.toLocaleDateString('zh-TW');
            const fullTime = orderDateObj.toLocaleTimeString('zh-TW', { hour12: false, hour: '2-digit', minute: '2-digit' });
            const displayFull = `${fullDate} ${fullTime}`;
            
            const isToday = fullDate === todayStr;

            if (isToday) {
                todaySum += parseInt(o.total || 0);
                todayQty++;
                tableFreq[o.table] = (tableFreq[o.table] || 0) + 1;
            }

            const isComp = o.isComp === true;

            tbody.innerHTML += `
                <tr style="${isComp ? 'opacity:0.6' : ''}">
                    <td class="${isToday ? 'date-today' : 'date-past'}">${displayFull}</td>
                    <td><b>${o.table} æ¡Œ</b></td>
                    <td style="font-size:13px; color:#666;">${o.items.join('ã€')}</td>
                    <td style="text-align:right; font-weight:bold; color:var(--primary-pink)">
                        $${o.total}
                    </td>
                    <td style="text-align:center">
                        <button class="btn-comp" onclick="compOrder('${o.id}')" ${isComp ? 'disabled' : ''}>å…å–®</button>
                        <button class="btn-del" onclick="deleteOrder('${o.id}')">åˆªé™¤</button>
                    </td>
                </tr>`;
        });

        document.getElementById('today-count').innerText = todayQty;
        document.getElementById('today-revenue').innerText = `$${todaySum}`;
        
        let max = 0, popular = "--";
        for(let t in tableFreq) {
            if(tableFreq[t] > max) { max = tableFreq[t]; popular = t + " æ¡Œ"; }
        }
        document.getElementById('top-table').innerText = popular;
    });

    function compOrder(id) {
        if(confirm("ç¢ºå®šè¦å°‡æ­¤è¨‚å–®è¨­ç‚ºã€Œå…å–®ã€å—ï¼Ÿ")) {
            db.ref('orders/' + id).update({ total: 0, isComp: true });
        }
    }

    function deleteOrder(id) {
        if(confirm("ç¢ºå®šè¦åˆªé™¤é€™ç­†è¨‚å–®å—ï¼Ÿ")) {
            db.ref('orders/' + id).remove();
        }
    }
</script>
</body>
</html>