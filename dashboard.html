<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlingOrder | ç‡Ÿé‹åˆ†æ (æ—¥çµç‰ˆ)</title>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-database-compat.js"></script>
    <style>
        :root { --primary-pink: #ff85a2; --bg: #fffafb; }
        body { font-family: "PingFang TC", sans-serif; background: var(--bg); margin: 0; padding: 20px; }
        .header { text-align: center; margin-bottom: 30px; }
        .title { color: var(--primary-pink); font-size: 26px; font-weight: bold; }
        
        /* æ•¸æ“šå¡ç‰‡ */
        .stat-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 20px; border-radius: 20px; text-align: center; box-shadow: 0 4px 15px rgba(255,133,162,0.1); border: 1px solid #fff0f3; }
        .stat-val { font-size: 32px; font-weight: 800; color: var(--primary-pink); margin: 10px 0; }
        .stat-label { color: #888; font-size: 14px; font-weight: bold; }

        /* è¨‚å–®æ¸…å–®è¡¨æ ¼ */
        .table-container { background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        table { width: 100%; border-collapse: collapse; }
        th { background: #fff0f3; color: #555; padding: 15px; text-align: left; font-size: 14px; }
        td { padding: 15px; border-bottom: 1px solid #f9f9f9; font-size: 14px; color: #444; }
        .comp-tag { color: #1976d2; font-weight: bold; background: #e3f2fd; padding: 2px 6px; border-radius: 4px; font-size: 11px; }
    </style>
</head>
<body>

<div class="header">
    <div class="title">ğŸ“Š ç‡Ÿé‹æ•¸æ“šåˆ†æä¸­å¿ƒ</div>
    <p id="current-date" style="color:#aaa;"></p>
</div>

<div class="stat-grid">
    <div class="stat-card">
        <div class="stat-label">æœ¬æ—¥ç‡Ÿæ”¶ (Today)</div>
        <div class="stat-val" id="today-rev">$0</div>
        <div class="stat-label" id="today-count" style="font-size: 12px;">å…± 0 ç­†</div>
    </div>
    <div class="stat-card">
        <div class="stat-label">æ­·å²ç¸½ç‡Ÿæ”¶ (Total)</div>
        <div class="stat-val" id="total-rev">$0</div>
        <div class="stat-label" style="font-size: 12px;">ç´¯è¨ˆè‡³ä»Š</div>
    </div>
</div>

<div class="table-container">
    <table>
        <thead>
            <tr>
                <th>æ™‚é–“</th>
                <th>æ¡Œè™Ÿ</th>
                <th>é‡‘é¡</th>
                <th>æ˜ç´°</th>
            </tr>
        </thead>
        <tbody id="order-tbody"></tbody>
    </table>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBTeLTAX-F5i3WHKYY0ITZsla0Qgs5e2zQ",
        authDomain: "blingorder.firebaseapp.com",
        projectId: "blingorder",
        databaseURL: "https://blingorder-default-rtdb.firebaseio.com",
        appId: "1:798993901664:web:9c2023b419ae099fe9fb05"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const today = new Date();
    document.getElementById('current-date').innerText = `çµç®—åŸºæº–æ—¥ï¼š${today.toLocaleDateString()}`;

    db.ref('orders').on('value', snap => {
        let todaySum = 0;
        let todayQty = 0;
        let totalSum = 0;
        const tbody = document.getElementById('order-tbody');
        tbody.innerHTML = "";

        const orders = [];
        snap.forEach(child => {
            const o = child.val();
            o.id = child.key;
            orders.unshift(o); // æœ€æ–°çš„æ’ä¸Šé¢
        });

        const todayStr = today.toLocaleDateString();

        orders.forEach(o => {
            const orderAmt = parseInt(o.total || 0);
            totalSum += orderAmt;

            // æ ¸å¿ƒé‚è¼¯ï¼šåˆ¤æ–·æ˜¯å¦ç‚ºæœ¬æ—¥è¨‚å–®
            // ç”±æ–¼ child.key æ˜¯ Date.now() ç”Ÿæˆçš„ï¼Œæˆ‘å€‘ç›´æ¥ç”¨å®ƒä¾†è½‰æ›æ—¥æœŸ
            const orderDate = new Date(parseInt(o.id || Date.now()));
            const isToday = orderDate.toLocaleDateString() === todayStr;

            if (isToday) {
                todaySum += orderAmt;
                todayQty++;
            }

            // é¡¯ç¤ºè¡¨æ ¼å…§å®¹
            const displayDate = orderDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            const dateLabel = isToday ? "" : `<br><small style="color:#ccc">${orderDate.toLocaleDateString()}</small>`;
            
            tbody.innerHTML += `
                <tr>
                    <td>${displayDate}${dateLabel}</td>
                    <td><b>${o.table}</b></td>
                    <td style="color:var(--primary-pink); font-weight:bold;">
                        ${o.isComp ? '<span class="comp-tag">å…å–®</span>' : ''} $${o.total}
                    </td>
                    <td style="font-size:12px; color:#666;">${o.items.join('ã€')}</td>
                </tr>`;
        });

        // æ›´æ–°æ•¸æ“šå¡ç‰‡
        document.getElementById('today-rev').innerText = `$${todaySum}`;
        document.getElementById('today-count').innerText = `æœ¬æ—¥å…± ${todayQty} ç­†`;
        document.getElementById('total-rev').innerText = `$${totalSum}`;
    });
</script>
</body>
</html>