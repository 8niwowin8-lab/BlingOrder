<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlingOrder - é»é¤é é¢</title>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-database-compat.js"></script>

    <style>
        /* é€™è£¡è² è²¬ç¶²é çš„æ¨£å­ï¼šç²‰å«©å¯æ„›é¢¨ */
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: #fffaf0; margin: 0; padding-bottom: 100px; color: #6d4c41; }
        header { background-color: #ffafcc; color: white; padding: 20px; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .table-info { background: #ffca3a; color: #6d4c41; padding: 5px; font-weight: bold; font-size: 0.9em; }
        .menu-container { padding: 10px; }
        .item-card { background: white; margin-bottom: 10px; padding: 15px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .item-info b { font-size: 1.1em; color: #ff85a2; }
        .add-btn { background-color: #ffafcc; color: white; border: none; padding: 10px 18px; border-radius: 20px; cursor: pointer; font-weight: bold; }
        .add-btn:active { background-color: #fb6f92; transform: scale(0.95); }
        
        /* åº•éƒ¨è³¼ç‰©è»Šæ¬„ä½ */
        .footer-bar { position: fixed; bottom: 0; width: 100%; background: white; border-top: 3px solid #ffafcc; padding: 15px 20px; box-sizing: border-box; display: flex; justify-content: space-between; align-items: center; }
        .total-text { font-size: 1.2em; font-weight: bold; }
        .submit-btn { background-color: #ff85a2; color: white; border: none; padding: 12px 25px; border-radius: 25px; font-size: 1em; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<header>
    <div style="font-size: 1.5em; letter-spacing: 2px;">BlingOrder âœ¨</div>
    <div class="table-info" id="display-table">æ­£åœ¨åµæ¸¬æ¡Œè™Ÿ...</div>
</header>

<div class="menu-container" id="menu-list">
    <p style="text-align: center; color: #999;">è¼‰å…¥èœå–®ä¸­ï¼Œè«‹ç¨å€™...</p>
</div>

<div class="footer-bar">
    <div class="total-text">ç¸½è¨ˆ: $<span id="total-price">0</span></div>
    <button class="submit-btn" onclick="submitOrder()">é€å‡ºè¨‚å–® ğŸš€</button>
</div>

<script>
    // --- 1. é€™æ˜¯ä½ çš„ Firebase é€£ç·šè¨­å®š (è«‹å‹¿æ›´å‹•) ---
    const firebaseConfig = {
        apiKey: "AIzaSyBTeLTAX-F5i3WHKYY0ITZsla0Qgs5e2zQ",
        authDomain: "blingorder.firebaseapp.com",
        projectId: "blingorder",
        storageBucket: "blingorder.firebasestorage.app",
        messagingSenderId: "798993901664",
        appId: "1:798993901664:web:9c2023b419ae099fe9fb05"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // --- 2. æŠ“å–ç¶²å€è£¡çš„æ¡Œè™Ÿ (ä¾‹å¦‚ ?table=A1) ---
    const urlParams = new URLSearchParams(window.location.search);
    const tableNo = urlParams.get('table') || "æœªå®šç¾©";
    document.getElementById('display-table').innerText = "ğŸ“ ç›®å‰ä½ç½®ï¼šæ¡Œè™Ÿ " + tableNo;

    // --- 3. é»é¤é‚è¼¯è®Šæ•¸ ---
    let myCart = [];
    let myTotal = 0;

    // --- 4. è‡ªå‹•å¾é›²ç«¯æŠ“å–æœ€æ–°èœå–® ---
    db.ref('menu').on('value', (snapshot) => {
        const menuList = document.getElementById('menu-list');
        menuList.innerHTML = ""; // å…ˆæ¸…ç©ºèˆŠå…§å®¹
        
        const data = snapshot.val();
        if (!data) {
            menuList.innerHTML = "<p style='text-align:center;'>ç›®å‰æ²’æœ‰ä¸Šæ¶ä»»ä½•é¤é»å–”ï¼</p>";
            return;
        }

        // æŠŠé›²ç«¯çš„é¤é»ä¸€å€‹ä¸€å€‹ç•«å‡ºä¾†
        for (let id in data) {
            const item = data[id];
            const itemHtml = `
                <div class="item-card">
                    <div class="item-info">
                        <b>${item.name}</b><br>
                        <small>$${item.price}</small>
                    </div>
                    <button class="add-btn" onclick="addToCart('${item.name}', ${item.price})">åŠ å…¥</button>
                </div>
            `;
            menuList.innerHTML += itemHtml;
        }
    });

    // --- 5. é»æ“Šã€ŒåŠ å…¥ã€æŒ‰éˆ•çš„åŠŸèƒ½ ---
    function addToCart(name, price) {
        myCart.push(name);
        myTotal += price;
        document.getElementById('total-price').innerText = myTotal;
    }

    // --- 6. é»æ“Šã€Œé€å‡ºè¨‚å–®ã€çš„åŠŸèƒ½ (å¾®èª¿å¾Œçš„ç‰ˆæœ¬) ---
    function submitOrder() {
        if(myCart.length === 0) {
            alert("è³¼ç‰©è»Šæ˜¯ç©ºçš„å–”ï¼è«‹å…ˆé¸æ“‡é¤é»ã€‚");
            return;
        }
        
        const orderId = Date.now(); // ç”¨ç•¶ä¸‹æ™‚é–“ç•¶ä½œç·¨è™Ÿ
        const now = new Date();
        const timeString = now.toLocaleTimeString(); // å–å¾—æ™‚é–“
        const dateString = `${now.getFullYear()}/${now.getMonth() + 1}/${now.getDate()}`; // å–å¾—æ—¥æœŸ

        // å°‡è¨‚å–®å­˜å…¥é›²ç«¯
        db.ref('orders/' + orderId).set({
            table: tableNo,
            items: myCart,
            total: myTotal,
            status: "å¾…è™•ç†",
            time: timeString,
            fullDate: dateString,
            timestamp: firebase.database.ServerValue.TIMESTAMP // çµ¦å ±è¡¨ç”¨çš„ç²¾ç¢ºæ™‚é–“
        }).then(() => {
            alert("è¨‚å–®å·²æˆåŠŸé€åˆ°è€é—†é‚£é‚Šå›‰ï¼è«‹ç¨å€™é¤é»ã€‚âœ¨");
            // é‡ç½®ç¶²é ç‹€æ…‹
            myCart = [];
            myTotal = 0;
            document.getElementById('total-price').innerText = "0";
        }).catch((error) => {
            alert("å“å‘€ï¼Œé€å–®å‡ºéŒ¯äº†ï¼š" + error.message);
        });
    }
</script>

</body>
</html>