<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlingOrder | å¤¢å¹»èœå–®</title>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-database-compat.js"></script>
    <style>
        :root { --primary-color: #ff85a2; --bg-color: #fcfcfc; }
        body { font-family: "PingFang TC", sans-serif; background: var(--bg-color); margin: 0; padding-bottom: 100px; color: #333; }
        
        /* é ‚éƒ¨å¤§åœ– */
        .banner-container { width: 100%; overflow: hidden; background: #fff; }
        .banner-container img { width: 100%; height: auto; display: block; }

        .brand-header { position: sticky; top: 0; background: white; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.05); text-align: center; padding: 15px 0; }
        .brand-name { font-size: 22px; font-weight: bold; color: var(--primary-color); margin-bottom: 10px; }
        
        /* åˆ†é¡å°è¦½ */
        .category-nav { display: flex; gap: 10px; overflow-x: auto; padding: 0 15px 15px; white-space: nowrap; }
        .category-nav::-webkit-scrollbar { display: none; }
        .cat-item { padding: 6px 15px; background: #f5f5f5; border-radius: 20px; font-size: 14px; color: #666; }
        .cat-item.active { background: var(--primary-color); color: white; }

        /* é¤é»ç¶²æ ¼ */
        .menu-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; padding: 12px; }
        .food-card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); position: relative; }
        .food-img-box { width: 100%; aspect-ratio: 1/1; background: #eee; }
        .food-img-box img { width: 100%; height: 100%; object-fit: cover; }
        .food-info { padding: 10px; }
        .food-name { font-weight: bold; font-size: 15px; display: block; margin-bottom: 4px; }
        .food-price { color: var(--primary-color); font-weight: bold; }

        /* å”®ç½„é®ç½© */
        .sold-out-mask { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.7); display: flex; align-items: center; justify-content: center; z-index: 10; }
        .sold-out-text { border: 2px solid #ff4d4d; color: #ff4d4d; padding: 2px 8px; font-weight: bold; transform: rotate(-15deg); }

        /* åº•éƒ¨è³¼ç‰©è»Š */
        .cart-bar { position: fixed; bottom: 20px; left: 5%; width: 90%; background: #333; color: white; border-radius: 40px; padding: 12px 20px; display: flex; justify-content: space-between; align-items: center; box-sizing: border-box; z-index: 1000; }
        .btn-order { background: var(--primary-color); border: none; color: white; padding: 8px 18px; border-radius: 20px; font-weight: bold; }
    </style>
</head>
<body>

    <div class="banner-container">
        <img src="images/banner.jpg" onerror="this.src='https://placehold.co/1200x600?text=BlingOrder+Banner'">
    </div>

    <div class="brand-header">
        <div class="brand-name">BlingOrder âœ¨</div>
        <div class="category-nav">
            <div class="cat-item active">å…¨éƒ¨é …ç›®</div>
            <div class="cat-item">ç†±é–€æ¨è–¦</div>
            <div class="cat-item">å’–å•¡é£²å“</div>
            <div class="cat-item">æ‰‹å·¥ç”œé»</div>
        </div>
    </div>

    <div class="menu-grid" id="menu-list"></div>

    <div class="cart-bar">
        <div>ğŸ›’ <span id="cart-count">0</span> é … | <span style="color:var(--primary-color)">$<span id="cart-total">0</span></span></div>
        <button class="btn-order" onclick="submitOrder()">é€å‡ºè¨‚å–®</button>
    </div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBTeLTAX-F5i3WHKYY0ITZsla0Qgs5e2zQ",
        authDomain: "blingorder.firebaseapp.com",
        projectId: "blingorder",
        databaseURL: "https://blingorder-default-rtdb.firebaseio.com",
        appId: "1:798993901664:web:9c2023b419ae099fe9fb05"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let cart = []; let total = 0;
    const tableNum = new URLSearchParams(window.location.search).get('table') || "A1";

    db.ref('menu').on('value', snap => {
        const list = document.getElementById('menu-list');
        list.innerHTML = "";
        snap.forEach(child => {
            const item = child.val();
            const id = child.key;
            const isSoldOut = item.isSoldOut === true;
            const imgSrc = item.image ? item.image : `images/${id}.jpg`;

            list.innerHTML += `
                <div class="food-card" onclick="${isSoldOut ? '' : `addToCart('${item.name}', ${item.price})`}">
                    ${isSoldOut ? '<div class="sold-out-mask"><div class="sold-out-text">SOLD OUT</div></div>' : ''}
                    <div class="food-img-box"><img src="${imgSrc}" onerror="this.src='https://placehold.co/500x500?text=Food'"></div>
                    <div class="food-info">
                        <span class="food-name">${item.name}</span>
                        <span class="food-price">$${item.price}</span>
                    </div>
                </div>
            `;
        });
    });

    function addToCart(n, p) {
        cart.push(n); total += parseInt(p);
        document.getElementById('cart-count').innerText = cart.length;
        document.getElementById('cart-total').innerText = total;
    }

    function submitOrder() {
        if(cart.length === 0) return alert("è³¼ç‰©è»Šæ˜¯ç©ºçš„ï¼");
        db.ref('orders/' + Date.now()).set({
            table: tableNum, items: cart, total: total, status: "å¾…è™•ç†",
            time: new Date().toLocaleTimeString(), date: new Date().toISOString().split('T')[0]
        }).then(() => { alert("è¨‚å–®é€å‡ºï¼"); cart=[]; total=0; document.getElementById('cart-count').innerText="0"; document.getElementById('cart-total').innerText="0"; });
    }
</script>
</body>
</html>