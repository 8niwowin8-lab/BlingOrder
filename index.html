<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlingOrder - é»é¤é é¢</title>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-database-compat.js"></script>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: #fffafb; margin: 0; padding-bottom: 100px; }
        .header { background: #ffafcc; color: white; padding: 20px; text-align: center; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .table-info { background: #ffca3a; color: #333; padding: 5px; font-weight: bold; margin-bottom: 10px; border-radius: 5px; display: inline-block; padding: 5px 15px; }
        .menu-container { padding: 15px; }
        .item-card { background: white; border-radius: 15px; padding: 15px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #ffdee9; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .item-card.sold-out { opacity: 0.5; filter: grayscale(1); }
        .item-info h3 { margin: 0; color: #ff85a2; }
        .item-price { color: #888; margin-top: 5px; }
        .btn-add { background: #ffafcc; color: white; border: none; padding: 10px 20px; border-radius: 20px; font-weight: bold; cursor: pointer; }
        .btn-add:disabled { background: #ccc; cursor: not-allowed; }
        .footer { position: fixed; bottom: 0; width: 100%; background: white; padding: 15px; border-top: 2px solid #ffafcc; display: flex; justify-content: space-between; align-items: center; box-sizing: border-box; }
        .btn-submit { background: #ff85a2; color: white; border: none; padding: 12px 30px; border-radius: 25px; font-size: 1.1em; font-weight: bold; }
    </style>
</head>
<body>

<div class="header">
    <h1>BlingOrder âœ¨</h1>
    <div class="table-info" id="display-table">æ¡Œè™Ÿï¼šæœªå®š</div>
</div>

<div class="menu-container" id="menu-list">
    <p style="text-align:center;">èœå–®è®€å–ä¸­...</p>
</div>

<div class="footer">
    <div style="font-size: 1.2em; font-weight: bold;">ç¸½è¨ˆ: $<span id="total-price">0</span></div>
    <button class="btn-submit" onclick="submitOrder()">é€å‡ºè¨‚å–® ğŸš€</button>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBTeLTAX-F5i3WHKYY0ITZsla0Qgs5e2zQ",
        authDomain: "blingorder.firebaseapp.com",
        projectId: "blingorder",
        databaseURL: "https://blingorder-default-rtdb.firebaseio.com",
        appId: "1:798993901664:web:9c2023b419ae099fe9fb05"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const urlParams = new URLSearchParams(window.location.search);
    const tableNo = urlParams.get('table') || "æœªå®š";
    document.getElementById('display-table').innerText = "ğŸ“ ç›®å‰ä½ç½®ï¼šæ¡Œè™Ÿ " + tableNo;

    let cart = [];
    let totalPrice = 0;

    // å³æ™‚å¾è³‡æ–™åº«è®€å–èœå–®
    db.ref('menu').on('value', snap => {
        const menuList = document.getElementById('menu-list');
        menuList.innerHTML = "";
        snap.forEach(child => {
            const item = child.val();
            const soldOutClass = item.isSoldOut ? 'sold-out' : '';
            const btnText = item.isSoldOut ? 'å”®ç½„' : 'åŠ å…¥';
            
            menuList.innerHTML += `
                <div class="item-card ${soldOutClass}">
                    <div class="item-info">
                        <h3>${item.name}</h3>
                        <div class="item-price">$${item.price}</div>
                    </div>
                    <button class="btn-add" ${item.isSoldOut ? 'disabled' : ''} onclick="addToCart('${item.name}', ${item.price})">
                        ${btnText}
                    </button>
                </div>
            `;
        });
    });

    function addToCart(name, price) {
        cart.push(name);
        totalPrice += price;
        document.getElementById('total-price').innerText = totalPrice;
    }

    function submitOrder() {
        if (cart.length === 0) return alert("è«‹è‡³å°‘é¸æ“‡ä¸€é …é¤é»å”·ï¼");
        const orderData = {
            table: tableNo,
            items: cart,
            total: totalPrice,
            time: new Date().toLocaleTimeString(),
            status: "å¾…è™•ç†"
        };
        db.ref('orders').push(orderData).then(() => {
            alert("è¨‚å–®å·²é€å‡ºï¼è«‹ç¨å€™é¤é» âœ¨");
            cart = [];
            totalPrice = 0;
            document.getElementById('total-price').innerText = "0";
        });
    }
</script>
</body>
</html>