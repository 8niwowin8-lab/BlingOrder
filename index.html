<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlingOrder | å¤¢å¹»èœå–®</title>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-database-compat.js"></script>
    <style>
        :root { --primary-pink: #ff85a2; --bg-color: #fcfcfc; }
        body { font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; background: var(--bg-color); margin: 0; padding-bottom: 120px; }
        
        .brand-header { position: sticky; top: 0; background: white; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.05); text-align: center; padding: 15px 0; }
        .brand-name { font-size: 22px; font-weight: bold; color: var(--primary-pink); }

        /* åˆ†é¡å°è¦½ */
        .category-nav { display: flex; gap: 10px; overflow-x: auto; padding: 10px; background: white; white-space: nowrap; border-bottom: 1px solid #eee; }
        .cat-btn { padding: 8px 16px; border-radius: 20px; border: 1px solid var(--primary-pink); background: white; color: var(--primary-pink); font-weight: bold; cursor: pointer; }
        .cat-btn.active { background: var(--primary-pink); color: white; }

        /* é¤é»ç¶²æ ¼ */
        .menu-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; padding: 12px; }
        .food-card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); display: flex; flex-direction: column; }
        .food-img-box { width: 100%; aspect-ratio: 1/1; background: #f0f0f0; }
        .food-img-box img { width: 100%; height: 100%; object-fit: cover; }
        .food-info { padding: 10px; display: flex; flex-direction: column; gap: 5px; flex-grow: 1; }
        .food-name { font-weight: bold; font-size: 15px; }
        .food-price { color: var(--primary-pink); font-weight: bold; }
        .note-input { width: 100%; border: 1px solid #eee; border-radius: 5px; padding: 5px; font-size: 12px; box-sizing: border-box; margin-top: 5px; }
        .btn-add { background: var(--primary-pink); color: white; border: none; padding: 10px; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: auto; }

        /* è³¼ç‰©è»Šæ¢ */
        .cart-bar { position: fixed; bottom: 20px; left: 5%; width: 90%; background: #333; color: white; border-radius: 15px; padding: 15px; box-sizing: border-box; z-index: 1000; }
        .cart-summary { display: flex; justify-content: space-between; align-items: center; }
    </style>
</head>
<body>

    <div class="brand-header">
        <div class="brand-name">BlingOrder âœ¨</div>
        <div class="category-nav" id="category-nav">
            <button class="cat-btn active" onclick="filterCategory('å…¨éƒ¨')">å…¨éƒ¨é …ç›®</button>
        </div>
    </div>

    <div class="menu-grid" id="menu-list"></div>

    <div class="cart-bar" id="cart-bar" style="display: none;">
        <div class="cart-summary">
            <div>ğŸ›’ <span id="cart-count">0</span> é … | <span style="color:var(--primary-pink); font-weight:bold;">$<span id="cart-total">0</span></span></div>
            <button onclick="alert('è¨‚å–®åŠŸèƒ½é–‹ç™¼ä¸­')" style="background:var(--primary-pink); color:white; border:none; padding:8px 15px; border-radius:15px; font-weight:bold;">é€å‡ºè¨‚å–®</button>
        </div>
    </div>

<script>
    // æ‚¨çš„ Firebase é…ç½® (èˆ‡ menu-edit.html ä¸€è‡´)
    const firebaseConfig = {
        apiKey: "AIzaSyBTeLTAX-F5i3WHKYY0ITZsla0Qgs5e2zQ",
        authDomain: "blingorder.firebaseapp.com",
        projectId: "blingorder",
        databaseURL: "https://blingorder-default-rtdb.firebaseio.com",
        appId: "1:798993901664:web:9c2023b419ae099fe9fb05"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let allItems = [];
    let cart = [];

    // ç›£è½ Firebase è³‡æ–™
    db.ref('menu').on('value', snap => {
        allItems = [];
        const categories = new Set();
        const nav = document.getElementById('category-nav');
        const list = document.getElementById('menu-list');

        snap.forEach(child => {
            const item = child.val();
            item.id = child.key;
            allItems.push(item);
            if(item.category && item.category !== "æœªåˆ†é¡") categories.add(item.category);
        });

        // å‹•æ…‹ç”Ÿæˆåˆ†é¡æŒ‰éˆ•
        nav.innerHTML = `<button class="cat-btn active" onclick="filterCategory('å…¨éƒ¨')">å…¨éƒ¨é …ç›®</button>`;
        categories.forEach(cat => {
            nav.innerHTML += `<button class="cat-btn" onclick="filterCategory('${cat}')">${cat}</button>`;
        });

        renderMenu(allItems);
    });

    function renderMenu(items) {
        const list = document.getElementById('menu-list');
        list.innerHTML = "";
        items.forEach(item => {
            const imgSrc = item.image ? item.image : 'https://placehold.co/300?text=Food';
            list.innerHTML += `
                <div class="food-card">
                    <div class="food-img-box"><img src="${imgSrc}" onerror="this.src='https://placehold.co/300?text=None'"></div>
                    <div class="food-info">
                        <span class="food-name">${item.name}</span>
                        <span class="food-price">$${item.price}</span>
                        <input type="text" id="note-${item.id}" class="note-input" placeholder="â• å‚™è¨» (å¦‚ï¼šå»å†°)">
                        <button class="btn-add" onclick="addToCart('${item.id}', '${item.name}', ${item.price})">åŠ å…¥</button>
                    </div>
                </div>
            `;
        });
    }

    function filterCategory(cat) {
        document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
        if(cat === 'å…¨éƒ¨') renderMenu(allItems);
        else renderMenu(allItems.filter(i => i.category === cat));
    }

    function addToCart(id, name, price) {
        const note = document.getElementById(`note-${id}`).value;
        cart.push({ name, price, note });
        document.getElementById(`note-${id}`).value = "";
        updateCartUI();
    }

    function updateCartUI() {
        const bar = document.getElementById('cart-bar');
        if(cart.length > 0) bar.style.display = 'block';
        document.getElementById('cart-count').innerText = cart.length;
        document.getElementById('cart-total').innerText = cart.reduce((s, i) => s + parseInt(i.price), 0);
    }
</script>
</body>
</html>