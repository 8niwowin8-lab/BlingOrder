<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlingOrder - é»é¤é é¢</title>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-database-compat.js"></script>
    <style>
        body { font-family: sans-serif; background-color: #fffafb; margin: 0; padding-bottom: 80px; }
        .header { background: #ffafcc; color: white; padding: 20px; text-align: center; font-size: 24px; font-weight: bold; }
        .table-info { background: #ffca3a; padding: 10px; text-align: center; font-weight: bold; }
        .item-card { background: white; margin: 10px; padding: 15px; border-radius: 15px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .item-info b { font-size: 18px; color: #ff85a2; }
        .btn-add { background: #ff85a2; color: white; border: none; padding: 8px 20px; border-radius: 20px; cursor: pointer; }
        
        /* å”®ç½„æ¨£å¼ */
        .sold-out { opacity: 0.5; filter: grayscale(1); pointer-events: none; position: relative; }
        .sold-out::after { content: "å·²å”®ç½„"; position: absolute; right: 20px; color: red; font-weight: bold; border: 2px solid red; padding: 2px 5px; transform: rotate(-15deg); }

        .footer { position: fixed; bottom: 0; width: 100%; background: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); box-sizing: border-box; }
        .btn-submit { background: #ff85a2; color: white; border: none; padding: 10px 20px; border-radius: 20px; font-size: 16px; }
    </style>
</head>
<body>
    <div class="header">BlingOrder âœ¨</div>
    <div class="table-info" id="table-display">ğŸ“ ç›®å‰ä½ç½®ï¼šæ¡Œè™Ÿè¼‰å…¥ä¸­...</div>
    <div id="menu-list"></div>
    <div class="footer">
        <div>ç¸½è¨ˆ: $<span id="total-price">0</span></div>
        <button class="btn-submit" onclick="submitOrder()">é€å‡ºè¨‚å–® ğŸš€</button>
    </div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBTeLTAX-F5i3WHKYY0ITZsla0Qgs5e2zQ",
        authDomain: "blingorder.firebaseapp.com",
        projectId: "blingorder",
        databaseURL: "https://blingorder-default-rtdb.firebaseio.com",
        appId: "1:798993901664:web:9c2023b419ae099fe9fb05"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const urlParams = new URLSearchParams(window.location.search);
    const tableNum = urlParams.get('table') || "æœªçŸ¥";
    document.getElementById('table-display').innerText = "ğŸ“ ç›®å‰ä½ç½®ï¼šæ¡Œè™Ÿ " + tableNum;

    let cart = [];
    let total = 0;

    // ç›£è½èœå–®ï¼ŒåŒ…å«å”®ç½„åˆ¤æ–·
    db.ref('menu').on('value', snap => {
        const list = document.getElementById('menu-list');
        list.innerHTML = "";
        snap.forEach(child => {
            const item = child.val();
            const isSoldOut = item.isSoldOut === true;
            list.innerHTML += `
                <div class="item-card ${isSoldOut ? 'sold-out' : ''}">
                    <div class="item-info">
                        <b>${item.name}</b><br>
                        <small>$${item.price}</small>
                    </div>
                    <button class="btn-add" onclick="addToCart('${item.name}', ${item.price})">åŠ å…¥</button>
                </div>
            `;
        });
    });

    function addToCart(name, price) {
        cart.push(name);
        total += price;
        document.getElementById('total-price').innerText = total;
    }

    function submitOrder() {
        if(cart.length === 0) return alert("é‚„æ²’é¸é¤é»å”·ï¼");
        db.ref('orders/' + Date.now()).set({
            table: tableNum,
            items: cart,
            total: total,
            status: "å¾…è™•ç†",
            time: new Date().toLocaleTimeString()
        }).then(() => {
            alert("è¨‚å–®å·²é€å‡ºï¼è«‹ç¨å€™é¤é» âœ¨");
            cart = []; total = 0;
            document.getElementById('total-price').innerText = "0";
        });
    }
</script>
</body>
</html>